var k=Object.defineProperty;var w=(u,e,o)=>e in u?k(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o;var t=(u,e,o)=>(w(u,typeof e!="symbol"?e+"":e,o),o);import{_ as B,W as I,r as g,k as f,l as i,F as b,n as a,w as p,m as E,t as v,z as D,A as C,C as A,V as L,O as y,D as F,E as V,p as $,s as N,u as m,o as _}from"./vendor.825dd2c3.js";import{u as P,a as T,_ as M}from"./index.16741bc9.js";var z=Object.defineProperty,O=Object.getOwnPropertyDescriptor,S=(u,e,o,s)=>{for(var r=s>1?void 0:s?O(e,o):e,l=u.length-1,n;l>=0;l--)(n=u[l])&&(r=(s?n(e,o,r):n(r))||r);return s&&r&&z(e,o,r),r};let d=class extends L{constructor(){super(...arguments);t(this,"authStore",P());t(this,"accountStore",T());t(this,"isLoading",!1);t(this,"isLoginMode",!0);t(this,"maskedPhoneNumber","");t(this,"smsAttempts",0);t(this,"confirmationToken","");t(this,"counter",30);t(this,"timeInterval",0);t(this,"form",{login:"",code:""});t(this,"errors",{login:"",code:""})}get isSmsBtnDisabled(){return this.counter>0}async submitCode(){var u;if(this.isLoading=!0,this.resetErrors(),!(this.form.code.length<4))try{await this.authStore.login({confirmationCode:this.form.code,confirmationToken:this.confirmationToken}),await this.accountStore.getPersonalData(),this.accountStore.isAdmin?await this.$router.push({name:"doc-admin"}):await this.$router.push({name:"op-doc"})}catch(e){this.errors.code=(u=e.response.data)==null?void 0:u.error.description}finally{this.isLoading=!1}}async submitLogin(){var u,e,o;this.isLoading=!0,this.resetErrors();try{const s=await this.authStore.getSMSCode(this.form.login);this.maskedPhoneNumber=s.maskedPhoneNumber||"",this.smsAttempts=s.smsAttempts,this.confirmationToken=s.confirmationToken||"",this.countSeconds(),this.isLoginMode=!1,this.$nextTick(()=>{this.$refs.smsInput.$refs.BInput.focus()})}catch(s){((u=s.response.data)==null?void 0:u.error.code)==="InvalidPhoneNumber"?this.errors.login="\u0412 \u043F\u0440\u043E\u0444\u0438\u043B\u0435 \u043D\u0435 \u0437\u0430\u0434\u0430\u043D \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430 \u0434\u043B\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438 \u0421\u041C\u0421":((e=s.response.data)==null?void 0:e.error.code)==="UserNotFound"?this.errors.login=`\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ${this.form.login} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`:this.errors.login=(o=s.response.data)==null?void 0:o.error.description}finally{this.isLoading=!1}}backToLogin(){this.isLoginMode=!0,this.form.login="",this.form.code=""}resetErrors(){this.errors={login:"",code:""}}resetCounter(){window.clearInterval(this.timeInterval),this.counter=30}countSeconds(){this.timeInterval&&this.resetCounter(),this.timeInterval=window.setInterval(()=>{this.counter--,this.counter<=0&&window.clearInterval(this.timeInterval)},1e3)}};S([I("form.code")],d.prototype,"submitCode",1);d=S([y({components:{BBtn:F,BInput:V}})],d);const U=d,j=u=>($("data-v-2307e6ed"),u=u(),N(),u),W={class:"auth-form"},q=j(()=>i("img",{class:"auth-form__logo",src:M},null,-1)),G=m(" \u0412\u043E\u0439\u0442\u0438 "),H={class:"auth-form-sms"},J={class:"auth-form-sms__login"},K=m(" \u041A\u043E\u0434 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u043D\u0430 \u043D\u043E\u043C\u0435\u0440 "),Q={class:"auth-form-sms__counter"},R=m(" \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u043F\u043E\u0432\u0442\u043E\u0440\u043D\u043E "),X=m(" \u0414\u0440\u0443\u0433\u043E\u0439 \u043B\u043E\u0433\u0438\u043D ");function Y(u,e,o,s,r,l){const n=g("b-input"),c=g("b-btn");return _(),f("div",W,[q,i("form",{onSubmit:e[2]||(e[2]=A(()=>{},["prevent"]))},[u.isLoginMode?(_(),f(b,{key:0},[a(n,{modelValue:u.form.login,"onUpdate:modelValue":e[0]||(e[0]=h=>u.form.login=h),error:u.errors.login,size:"l",placeholder:"\u041B\u043E\u0433\u0438\u043D",autofocus:""},null,8,["modelValue","error"]),a(c,{disabled:!u.form.login,loading:u.isLoading,class:"auth-form__btn",block:"",size:"m",onClick:u.submitLogin},{default:p(()=>[G]),_:1},8,["disabled","loading","onClick"])],64)):E("",!0),u.isLoginMode?E("",!0):(_(),f(b,{key:1},[a(n,{modelValue:u.form.code,"onUpdate:modelValue":e[1]||(e[1]=h=>u.form.code=h),ref:"smsInput",error:u.errors.code,size:"l",placeholder:"\u041A\u043E\u0434 \u0438\u0437 \u0421\u041C\u0421",maxlength:"4",autofocus:""},null,8,["modelValue","error"]),i("div",H,[i("div",J,[K,i("div",null,v(u.maskedPhoneNumber),1)]),D(i("div",{class:"auth-form-sms__counter"},v(u.counter)+" \u0441\u0435\u043A\u0443\u043D\u0434 \u0434\u043E \u043F\u043E\u0432\u0442\u043E\u0440\u043D\u043E\u0439 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438 ",513),[[C,u.isSmsBtnDisabled]]),D(i("div",Q," \u041A\u043E\u0434 \u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u043F\u043E\u0432\u0442\u043E\u0440\u043D\u043E ",512),[[C,!u.isSmsBtnDisabled]])]),a(c,{disabled:u.isSmsBtnDisabled,class:"auth-form__btn",block:"",size:"m",type:"uncolored",onClick:u.submitLogin},{default:p(()=>[R]),_:1},8,["disabled","onClick"]),a(c,{class:"auth-form__btn",type:"outline",block:"",size:"m",onClick:u.backToLogin},{default:p(()=>[X]),_:1},8,["onClick"])],64))],32)])}var eu=B(U,[["render",Y],["__scopeId","data-v-2307e6ed"]]);export{eu as default};
