var G=Object.defineProperty,H=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var E=(t,e,i)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,h=(t,e)=>{for(var i in e||(e={}))J.call(e,i)&&E(t,i,e[i]);if(T)for(var i of T(e))X.call(e,i)&&E(t,i,e[i]);return t},_=(t,e)=>H(t,q(e));var c=(t,e,i)=>(E(t,typeof e!="symbol"?e+"":e,i),i);import{e as M,O as $,G as z,H as K,_ as O,V as P,r as C,o as p,f as k,w as v,l as a,n as D,t as r,I as y,m as U,k as g,F as w,J as b,E as Q,p as Y,s as Z}from"./vendor.825dd2c3.js";import{U as x,h as tt}from"./index.16741bc9.js";import{f as et}from"./forrmaters.4a830e90.js";import{r as B,t as F,f as it}from"./date.7878141a.js";import{g as st,a as ot}from"./index.056d9d85.js";import{S as N}from"./v1.ca8a8197.js";var nt=6e4;function at(t,e){return B(2,arguments),F(t).getTime()-F(e).getTime()}var A={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},ut="trunc";function rt(t){return t?A[t]:A[ut]}function L(t,e,i){B(2,arguments);var o=at(t,e)/nt;return rt(i==null?void 0:i.roundingMethod)(o)}var lt=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,I=(t,e,i,o)=>{for(var s=o>1?void 0:o?ct(e,i):e,d=t.length-1,u;d>=0;d--)(u=t[d])&&(s=(o?u(e,i,s):u(s))||s);return o&&s&&lt(e,i,s),s};let f=class extends P{constructor(){super(...arguments);c(this,"doctor");c(this,"overdueMinutes");c(this,"expiresMinutes");c(this,"columns",[{key:"number",label:"\u041D\u043E\u043C\u0435\u0440 \u0437\u0430\u0434\u0430\u0447\u0438",sortable:!1},{key:"clientProfile",label:"\u0424\u0418\u041E \u043A\u043B\u0438\u0435\u043D\u0442\u0430",sortable:!1},{key:"data",label:"\u041D\u043E\u043C\u0435\u0440 \u0437\u0430\u0434\u0430\u0447\u0438 \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0438",sortable:!1},{key:"creationDate",label:"\u0414\u0430\u0442\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044F \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0438",sortable:!1}]);c(this,"items",[{isActive:!0,age:40,first_name:"Dickerson",last_name:"Macdonald"},{isActive:!1,age:21,first_name:"Larsen",last_name:"Shaw"},{isActive:!1,age:89,first_name:"Geneva",last_name:"Wilson"},{isActive:!0,age:38,first_name:"Jami",last_name:"Carney"}])}get fio(){return et(this.doctor)}get sortedTasks(){return this.doctor.tasks.map(t=>{const e=L(new Date,new Date(t.creationDate));return _(h({},t),{minutesFromStartIssue:e,overdue:e>=this.overdueMinutes,expires:e>this.expiresMinutes&&e<this.overdueMinutes})}).sort((t,e)=>t.minutesFromStartIssue==e.minutesFromStartIssue?0:t.minutesFromStartIssue<e.minutesFromStartIssue?1:-1)}get tasksCounts(){let t=0,e=0;return this.sortedTasks.forEach(i=>{i.minutesFromStartIssue>=this.overdueMinutes?t++:i.minutesFromStartIssue>this.expiresMinutes&&e++}),{overdueTasksCount:t,expiresTasksCount:e}}getTdStyle(t){return{mExpires:t.expires,mOverdue:t.overdue}}date(t){return t?it(new Date(t),"HH:mm dd/MM"):"\u2014"}clientFio(t){return!t.data||!t.data.clientLastName||!t.data.clientFirstName||!t.data.clientMiddleName?"\u2014":`${t.data.clientLastName||""} ${t.data.clientFirstName&&t.data.clientFirstName[0]||""}.${t.data.clientMiddleName&&t.data.clientMiddleName[0]||""}.`.trim()}};I([M(Object)],f.prototype,"doctor",2);I([M(Number)],f.prototype,"overdueMinutes",2);I([M(Number)],f.prototype,"expiresMinutes",2);f=I([$({components:{BAccordion:z,BTable:K,UserAvatar:x}})],f);const dt=f,pt={class:"monitoring-item-content"},mt={class:"monitoring-item-content__col"},ht={class:"monitoring-item-content__col"},vt={class:"monitoring-item-content__name b-text-m"},yt={class:"monitoring-item-content__tasks"};function ft(t,e,i,o,s,d){const u=C("user-avatar"),m=C("b-table"),n=C("b-accordion");return t.doctor?(p(),k(n,{key:0,class:"monitoring-item"},{title:v(()=>[a("div",pt,[a("div",mt,[D(u,{"avatar-id":t.doctor.avatarId},null,8,["avatar-id"])]),a("div",ht,[a("div",vt,r(t.fio),1),a("div",yt," \u0417\u0430\u0434\u0430\u0447 "+r(t.doctor.tasks&&t.doctor.tasks.length)+", \u0418\u0441\u0442\u0435\u043A\u0430\u0435\u0442: "+r(t.tasksCounts.expiresTasksCount)+", \u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D\u043E: "+r(t.tasksCounts.overdueTasksCount),1)])])]),default:v(()=>[D(m,{columns:t.columns,items:t.sortedTasks},{td_number:v(l=>[a("div",{class:y(t.getTdStyle(l.item))},r(l.item.number),3)]),td_clientProfile:v(l=>[a("div",{class:y(t.getTdStyle(l.item))},r(t.clientFio(l.item)),3)]),td_data:v(l=>[a("div",{class:y(t.getTdStyle(l.item))},r(l.consultationTask||"\u041F\u043E \u043A\u0430\u043B\u0435\u043D\u0434\u0430\u0440\u044E"),3)]),td_creationDate:v(l=>[a("div",{class:y(t.getTdStyle(l.item))},r(t.date(l.item.creationDate)),3)]),_:1},8,["columns","items"])]),_:1})):U("",!0)}var _t=O(dt,[["render",ft],["__scopeId","data-v-837bd83c"]]);const gt="/api/supporttask/v2";async function Ct(t){const{data:e}=await tt.get(`${gt}/issue`,{params:t});return e}var R=(t=>(t.DOCADD_TELEMED="DOCADD.TELEMED",t))(R||{}),V=(t=>(t.New="New",t.InProgress="InProgress",t.WaitingResponse="WaitingResponse",t.Completed="Completed",t.Canceled="Canceled",t.WaitingResponseFromClient="WaitingResponseFromClient",t.ClientContact="ClientContact",t.Record="Record",t.PaymentUrlSending="PaymentUrlSending",t.PaymentStatusChecking="PaymentStatusChecking",t.GuaranteeLetterSending="GuaranteeLetterSending",t.FollowUp="FollowUp",t.AgreementInsuranceCompany="AgreementInsuranceCompany",t))(V||{}),It="/img/stethoscope.svg",Et="/img/receipt.svg",Dt="/img/warning.svg";var St=Object.defineProperty,Mt=Object.getOwnPropertyDescriptor,Tt=(t,e,i,o)=>{for(var s=o>1?void 0:o?Mt(e,i):e,d=t.length-1,u;d>=0;d--)(u=t[d])&&(s=(o?u(e,i,s):u(s))||s);return o&&s&&St(e,i,s),s};const wt=2e4;let S=class extends P{constructor(){super(...arguments);c(this,"specialties",[]);c(this,"doctors",[]);c(this,"specialityCount",{all:{count:0,overdue:0,doctors:[]}});c(this,"selectedSpeciality","");c(this,"doctorLastName","");c(this,"interval",0);c(this,"OVERDUE_MINUTES",60);c(this,"EXPIRES_MINUTES",50)}get specialtiesSortedByCount(){return[...this.specialties].sort((t,e)=>{const i=this.specialityCount[t.specialityId]&&this.specialityCount[t.specialityId].count,o=this.specialityCount[e.specialityId]&&this.specialityCount[e.specialityId].count;return i===void 0||o===void 0||i===o?0:i>o?-1:1})}get sortedDoctors(){return!this.selectedSpeciality||!this.specialityCount[this.selectedSpeciality]||!this.specialityCount[this.selectedSpeciality].doctors||!this.specialityCount[this.selectedSpeciality].doctors.length?[]:[...this.specialityCount[this.selectedSpeciality].doctors].filter(t=>t.lastName&&t.lastName.toLocaleLowerCase().startsWith(this.doctorLastName.toLocaleLowerCase())).sort((t,e)=>{var i,o;return t.tasks.length===e.tasks.length?0:((i=t.tasks)==null?void 0:i.length)<((o=e.tasks)==null?void 0:o.length)?1:-1})}selectSpeciality(t){this.selectedSpeciality=this.selectedSpeciality===t?"":t}async fetchSpecialties(){const e=(await st()).filter(i=>i.activityTypes&&i.activityTypes.some(o=>o.activityType==="TELEMED"&&o.flags&&o.flags.some(s=>s===N.IsUrgently||s===N.IsDirectly)));e.forEach(i=>{this.specialityCount=_(h({},this.specialityCount),{[i.specialityId]:{count:0,overdue:0,doctors:[]}})}),this.specialties=e,this.specialityCount.all={count:0,overdue:0,doctors:[]}}async fetchDoctors(){const t=(await ot()).map(e=>_(h({},e),{tasks:[]}));t.forEach(e=>{var i;(i=e.specialities)==null||i.forEach(o=>{const s=this.specialityCount[o.specialityId];s&&(this.specialityCount[o.specialityId].doctors=[...s.doctors,e]),!this.specialityCount.all.doctors.some(u=>u.doctorId===e.doctorId)&&this.specialityCount.all.doctors.push(h({},e))})}),this.doctors=t}resetCount(){Object.keys(this.specialityCount).forEach(t=>{this.specialityCount[t].count=0,this.specialityCount[t].overdue=0,this.specialityCount[t].doctors=this.specialityCount[t].doctors.map(e=>_(h({},e),{tasks:[]}))})}calcIssues(t){t.forEach(e=>{var u,m;const i=this.doctors.find(n=>n.doctorId===e.operatorId);if(!i||!i.specialities||!i.specialities.length)return;const o=e.data&&e.data;let s=o==null?void 0:o.specialityId;if(!s){const n=i.specialities.find(l=>Object.keys(this.specialityCount).some(W=>W===l.specialityId));s=n&&n.specialityId?n.specialityId:s}if(!s)return;this.specialityCount[s].count=this.specialityCount[s].count+1,this.specialityCount.all.count=this.specialityCount.all.count+1,(u=this.specialityCount[s].doctors.find(n=>n.doctorId===i.doctorId))==null||u.tasks.push(e),(m=this.specialityCount.all.doctors.find(n=>n.doctorId===i.doctorId))==null||m.tasks.push(e),L(new Date,new Date(e.creationDate))>this.OVERDUE_MINUTES&&(this.specialityCount[s].overdue=this.specialityCount[s].overdue+1,this.specialityCount.all.overdue+=1)})}async fetchIssues(){const{data:t}=await Ct({queueName:[R.DOCADD_TELEMED],status:[V.InProgress]});this.resetCount(),t&&this.calcIssues(t),this.interval&&window.clearTimeout(this.interval),this.interval=window.setTimeout(this.fetchIssues,wt)}async mounted(){await this.fetchSpecialties(),await this.fetchDoctors(),await this.fetchIssues()}beforeUnmount(){this.interval&&window.clearTimeout(this.interval)}};S=Tt([$({components:{BInput:Q,MonitoringItem:_t}})],S);const bt=S,j=t=>(Y("data-v-44c948cb"),t=t(),Z(),t),Ft={class:"monitoring"},Nt={class:"monitoring-col"},At=j(()=>a("div",{class:"monitoring-spec"},[a("div",null,"\u0421\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u044C"),a("img",{class:"monitoring-spec__icon",title:"\u0412\u0440\u0430\u0447\u0435\u0439",src:It}),a("img",{class:"monitoring-spec__icon",title:"\u0417\u0430\u0434\u0430\u0447\u0438 \u043F\u043E \u043F\u0440\u0435\u043A\u0440\u0435\u043F\u043B\u0435\u043D\u0438\u044E \u0434\u043E\u043A\u0443\u043C\u0435\u043D\u0442\u043E\u0432",src:Et}),a("img",{class:"monitoring-spec__icon",title:"\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D\u043E",src:Dt})],-1)),$t=j(()=>a("div",null,"\u0412\u0441\u0435 \u0432\u0440\u0430\u0447\u0438",-1)),Ot=["onClick"],Pt={key:0,class:"monitoring-col"},kt={class:"monitoring-list"},Ut={class:"monitoring-list__filter"};function Bt(t,e,i,o,s,d){const u=C("b-input"),m=C("monitoring-item");return p(),g("div",Ft,[a("div",Nt,[At,a("div",{class:y(["monitoring-spec",{mActive:t.selectedSpeciality==="all"}]),onClick:e[0]||(e[0]=n=>t.selectSpeciality("all"))},[$t,a("div",null,r(t.specialityCount.all&&t.specialityCount.all.doctors.length),1),a("div",null,r(t.specialityCount.all&&t.specialityCount.all.count),1),a("div",null,r(t.specialityCount.all&&t.specialityCount.all.overdue),1)],2),(p(!0),g(w,null,b(t.specialtiesSortedByCount,n=>(p(),g("div",{key:n.specialityId,class:y([{mActive:n.specialityId===t.selectedSpeciality,mOverdue:t.specialityCount[n.specialityId].overdue},"monitoring-spec"]),onClick:l=>t.selectSpeciality(n.specialityId)},[a("div",null,r(n.specialityName),1),a("div",null,r(t.specialityCount[n.specialityId].doctors.length),1),a("div",null,r(t.specialityCount[n.specialityId]&&t.specialityCount[n.specialityId].count),1),a("div",null,r(t.specialityCount[n.specialityId]&&t.specialityCount[n.specialityId].overdue),1)],10,Ot))),128))]),t.selectedSpeciality?(p(),g("div",Pt,[a("div",kt,[a("div",Ut,[D(u,{modelValue:t.doctorLastName,"onUpdate:modelValue":e[1]||(e[1]=n=>t.doctorLastName=n),placeholder:"\u0424\u0438\u043B\u044C\u0442\u0440 \u043F\u043E \u0444\u0430\u043C\u0438\u043B\u0438\u0438 \u0432\u0440\u0430\u0447\u0430"},null,8,["modelValue"])]),(p(!0),g(w,null,b(t.sortedDoctors,n=>(p(),k(m,{key:n.doctorId,doctor:n,"overdue-minutes":t.OVERDUE_MINUTES,"expires-minutes":t.EXPIRES_MINUTES},null,8,["doctor","overdue-minutes","expires-minutes"]))),128))])])):U("",!0)])}var qt=O(bt,[["render",Bt],["__scopeId","data-v-44c948cb"]]);export{qt as default};
