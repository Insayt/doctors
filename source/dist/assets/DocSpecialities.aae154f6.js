var A=Object.defineProperty,V=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var f=(u,e,i)=>e in u?A(u,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[e]=i,D=(u,e)=>{for(var i in e||(e={}))N.call(e,i)&&f(u,i,e[i]);if(T)for(var i of T(e))$.call(e,i)&&f(u,i,e[i]);return u},B=(u,e)=>V(u,I(e));var o=(u,e,i)=>(f(u,typeof e!="symbol"?e+"":e,i),i);import{_ as O,W as P,r as _,k as p,n as r,l as y,w as m,F as w,J as C,V as U,O as j,D as W,K as J,L as K,o as d,t as g,u as b}from"./vendor.825dd2c3.js";import{b as L,u as q,c as z,r as G,g as H}from"./index.056d9d85.js";import{N as F}from"./notify.a97b9367.js";import{S as v}from"./v1.ca8a8197.js";import"./index.16741bc9.js";var M=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,k=(u,e,i,t)=>{for(var a=t>1?void 0:t?Q(e,i):e,s=u.length-1,c;s>=0;s--)(c=u[s])&&(a=(t?c(e,i,a):c(a))||a);return t&&a&&M(e,i,a),a};let h=class extends U{constructor(){super(...arguments);o(this,"activityTypes",[]);o(this,"specialties",[]);o(this,"activityType",null);o(this,"newSpeciality",null);o(this,"loading",!1);o(this,"flags",[{key:v.ConsultAvailable,label:"\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u0430 \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u044F"},{key:v.AskForPainScale,label:"\u0417\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0442\u044C \u0443\u0440\u043E\u0432\u0435\u043D\u044C \u0431\u043E\u043B\u0438"},{key:v.IsUrgently,label:"\u0415\u0441\u0442\u044C \u043B\u0438 \u0434\u0430\u043D\u043D\u044B\u0439 \u0441\u043F\u0435\u0446\u0438\u0430\u043B\u0438\u0441\u0442 \u0432 \u043F\u0440\u0438\u043D\u0446\u0438\u043F\u0435 \u0432 \u0441\u043F\u0438\u0441\u043A\u0435 \u0434\u043B\u044F \u0441\u0440\u043E\u0447\u043D\u043E\u0439 \u0437\u0430\u043F\u0438\u0441\u0438."},{key:v.IsDirectly,label:"E\u0441\u0442\u044C \u043B\u0438 \u0434\u0430\u043D\u043D\u044B\u0439 \u0441\u043F\u0435\u0446\u0438\u0430\u043B\u0438\u0441\u0442 \u0432 \u043F\u0440\u0438\u043D\u0446\u0438\u043F\u0435 \u0432 \u0441\u043F\u0438\u0441\u043A\u0435 \u0434\u043B\u044F \u0437\u0430\u043F\u0438\u0441\u0438 \u043D\u0430 \u0434\u0430\u0442\u0443."}])}getFlagValue(u,e){var i;return(i=u.activityType.flags)==null?void 0:i.some(t=>t===e.key)}async fetch(){this.loading=!0;try{await this.fetchTypes()}finally{this.loading=!1}}async fetchTypes(){const u=await L();this.activityTypes=u.map(e=>({label:e.description,value:e.name})),this.activityType||(this.activityType=this.activityTypes&&this.activityTypes.length>0&&this.activityTypes[0])}async checkFlag(u,e){if(this.loading)return;const i=e.activityType.flags||[],t=i==null?void 0:i.some(s=>s===u);let a=[...i];t?a=[...i.filter(s=>s!==u)]:a.push(u),this.loading=!0;try{await q(this.activityType.value,e.specialityId,{priority:e.activityType.priority,flags:a})}catch{F.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0444\u043B\u0430\u0433\u043E\u0432 \u0441\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u0438")}finally{await this.fetchSpecialities(),this.loading=!1}}async add(){var u,e,i;this.loading=!0;try{await z((u=this.activityType)==null?void 0:u.value,(e=this.newSpeciality)==null?void 0:e.value),await this.fetchSpecialities(),this.newSpeciality=null}catch(t){F.error((i=t.response.data)==null?void 0:i.error.description)}finally{this.loading=!1}}async remove(u){if(!(!u||!this.activityType)){this.loading=!0;try{await G(this.activityType.value,u),await this.fetchSpecialities()}catch{F.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0441\u0442\u0438 \u0441\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u0438")}finally{this.loading=!1}}}async fetchSpecialities(){if(!this.activityType){this.specialties=[],this.newSpeciality=null;return}const e=(await H({activityType:this.activityType.value})).map(i=>{const t=(i.activityTypes||[]).find(a=>{var s;return a.activityType===((s=this.activityType)==null?void 0:s.value)});if(t)return B(D({},i),{label:i.specialityName,value:i.specialityId,activityType:t})});this.specialties=e.filter(Boolean)}mounted(){this.fetch()}};k([P("activityType")],h.prototype,"fetchSpecialities",1);h=k([j({components:{BBtn:W,BSelect:J,BCheckbox:K}})],h);const R=h,X={class:"docSpecialities"},Y={class:"docSpecialities__row"},Z=b(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C "),x={class:"docSpecialities-item__title"},u4={class:"b-text-mb"},e4={class:"b-caption-s"},i4=b("\u0423\u0434\u0430\u043B\u0438\u0442\u044C"),t4={class:"docSpecialities-item__flags"};function a4(u,e,i,t,a,s){const c=_("b-select"),S=_("b-btn"),E=_("b-checkbox");return d(),p("div",X,[r(c,{modelValue:u.activityType,"onUpdate:modelValue":e[0]||(e[0]=l=>u.activityType=l),placeholder:"\u0422\u0438\u043F \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0441\u0442\u0435\u0439",options:u.activityTypes},null,8,["modelValue","options"]),y("div",Y,[r(c,{modelValue:u.newSpeciality,"onUpdate:modelValue":e[1]||(e[1]=l=>u.newSpeciality=l),class:"docSpecialities__specSelect",placeholder:"\u0421\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u044C",options:u.specialties,disabled:u.specialties&&u.specialties.length<1},null,8,["modelValue","options","disabled"]),r(S,{block:"",disabled:!u.newSpeciality||u.loading,loading:u.loading,onClick:u.add},{default:m(()=>[Z]),_:1},8,["disabled","loading","onClick"])]),(d(!0),p(w,null,C(u.specialties,l=>(d(),p("div",{key:l.specialityId,class:"docSpecialities-item"},[y("div",x,[y("div",u4,g(l.specialityName),1),y("div",e4,g(l.info),1),r(S,{type:"pale",loading:u.loading,onClick:n=>u.remove(l.specialityId)},{default:m(()=>[i4]),_:2},1032,["loading","onClick"])]),y("div",t4,[(d(!0),p(w,null,C(u.flags,n=>(d(),p("div",{key:n.key,class:"docSpecialities-item__flag"},[r(E,{"model-value":u.getFlagValue(l,n),onInput:s4=>u.checkFlag(n.key,l)},{default:m(()=>[b(g(n.label),1)]),_:2},1032,["model-value","onInput"])]))),128))])]))),128))])}var y4=O(R,[["render",a4],["__scopeId","data-v-0707f2ea"]]);export{y4 as default};
