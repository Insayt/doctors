var k=Object.defineProperty,x=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var V=(e,t,o)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,M=(e,t)=>{for(var o in t||(t={}))te.call(t,o)&&V(e,o,t[o]);if(K)for(var o of K(t))oe.call(t,o)&&V(e,o,t[o]);return e},j=(e,t)=>x(e,ee(t));var a=(e,t,o)=>(V(e,typeof t!="symbol"?t+"":t,o),o);import{e as $,O as I,U as se,_ as g,V as C,r as u,o as n,k as p,l as m,t as w,n as _,w as f,u as y,I as re,W as U,E as Q,F as H,J as z,X as ie,D as T,i as ce,f as O,C as ne,j as ae,m as ue,G as le,p as de,s as _e}from"./vendor.825dd2c3.js";import{g as pe,a as ve,b as me,d as fe}from"./index.1178ea57.js";import{N as q}from"./notify.a97b9367.js";import{U as he,b as we}from"./index.16741bc9.js";var $e=Object.defineProperty,ye=Object.getOwnPropertyDescriptor,F=(e,t,o,r)=>{for(var s=r>1?void 0:r?ye(t,o):t,c=e.length-1,i;c>=0;c--)(i=e[c])&&(s=(r?i(t,o,s):i(s))||s);return r&&s&&$e(t,o,s),s};let A=class extends C{constructor(){super(...arguments);a(this,"doctor");a(this,"selected")}get fullName(){const{lastName:e,firstName:t,middleName:o}=this.doctor;return`${e} ${t} ${o}`}selectHandler(){this.$emit("select",this.doctor.doctorId)}};F([$({type:Object,required:!0})],A.prototype,"doctor",2);F([$({type:Boolean,default:!1})],A.prototype,"selected",2);A=F([I({components:{BBadge:se,UserAvatar:he},emits:["select"]})],A);const De=A,Ie={class:"doctor-reviews-item__detail"},ge={class:"doctor-reviews-item__name"},Ce={class:"doctor-reviews-item__count"},Re=y(" \u041E\u0442\u0437\u044B\u0432\u044B: "),Ae={class:"doctor-reviews-item__avatar"};function Be(e,t,o,r,s,c){const i=u("BBadge"),l=u("UserAvatar");return n(),p("div",{class:re(["doctor-reviews-item",{"doctor-reviews-item--selected":e.selected}]),onClick:t[0]||(t[0]=(...v)=>e.selectHandler&&e.selectHandler(...v))},[m("div",Ie,[m("div",ge,w(e.fullName),1),m("div",Ce,[Re,_(i,{size:"s"},{default:f(()=>[y(w(e.doctor.notModeratedCommentsCount),1)]),_:1})])]),m("div",Ae,[_(l,{"avatar-id":e.doctor.avatarId},null,8,["avatar-id"])])],2)}var be=g(De,[["render",Be],["__scopeId","data-v-105af877"]]);var Oe=Object.defineProperty,Ee=Object.getOwnPropertyDescriptor,Y=(e,t,o,r)=>{for(var s=r>1?void 0:r?Ee(t,o):t,c=e.length-1,i;c>=0;c--)(i=e[c])&&(s=(r?i(t,o,s):i(s))||s);return r&&s&&Oe(t,o,s),s};let E=class extends C{constructor(){super(...arguments);a(this,"searchDoctor","");a(this,"doctors",[]);a(this,"selectedDoctor",null)}get filteredDoctors(){return this.searchDoctor?this.doctors.filter(e=>`${e.lastName}${e.firstName}${e.middleName}`.toLowerCase().includes(this.searchDoctor.toLowerCase())):this.doctors}selectDoctorHandler(e){const t=this.doctors.find(o=>o.doctorId===e);this.selectedDoctor=t||null,this.$router.push({query:j(M({},this.$route.query),{doctorId:t==null?void 0:t.doctorId})})}async fetchDoctors(){var e;try{this.doctors=await pe()}catch(t){q.error((e=t.response.data)==null?void 0:e.error.description)}}mounted(){this.fetchDoctors().then(()=>this.selectDoctorHandler(this.$route.query.doctorId))}};Y([U("$route.query.activityId")],E.prototype,"fetchDoctors",1);E=Y([I({components:{BInput:Q,DoctorReviewsItem:be}})],E);const Pe=E,Ne={class:"doctors-reviews"},Ve={key:0,class:"doctors-reviews__doctor-list"},Me={key:1,class:"doctors-reviews__empty"};function je(e,t,o,r,s,c){const i=u("b-input"),l=u("DoctorReviewsItem");return n(),p("div",Ne,[_(i,{modelValue:e.searchDoctor,"onUpdate:modelValue":t[0]||(t[0]=v=>e.searchDoctor=v),size:"s",placeholder:"\u041F\u043E\u0438\u0441\u043A",class:"doctors-reviews__search"},null,8,["modelValue"]),e.filteredDoctors.length?(n(),p("div",Ve,[(n(!0),p(H,null,z(e.filteredDoctors,v=>{var h;return n(),p("div",{key:v.doctorId,class:"doctors-reviews__doctor-item"},[_(l,{doctor:v,selected:v.doctorId===((h=e.selectedDoctor)==null?void 0:h.doctorId),onSelect:e.selectDoctorHandler},null,8,["doctor","selected","onSelect"])])}),128))])):(n(),p("div",Me,"\u041D\u043E\u0432\u044B\u0445 \u043E\u0442\u0437\u044B\u0432\u043E\u0432 \u043D\u0435\u0442"))])}var qe=g(Pe,[["render",je],["__scopeId","data-v-021f7c7a"]]),Se=Object.defineProperty,Ue=Object.getOwnPropertyDescriptor,R=(e,t,o,r)=>{for(var s=r>1?void 0:r?Ue(t,o):t,c=e.length-1,i;c>=0;c--)(i=e[c])&&(s=(r?i(t,o,s):i(s))||s);return r&&s&&Se(t,o,s),s};let D=class extends C{constructor(){super(...arguments);a(this,"rating");a(this,"maxRating");a(this,"size");a(this,"color")}setRating(e=0){return e}};R([$({type:Number,required:!0})],D.prototype,"rating",2);R([$({type:Number,default:5})],D.prototype,"maxRating",2);R([$({type:[Number,String],default:"inherit"})],D.prototype,"size",2);R([$({type:String,default:"$b-support-203"})],D.prototype,"color",2);R([ie("update:rating")],D.prototype,"setRating",1);D=R([I({components:{BBtn:T,BIcon:ce},emits:["update:rating"]})],D);const He=D,ze={class:"star-rating"};function Te(e,t,o,r,s,c){const i=u("BIcon");return n(),p("div",ze,[(n(!0),p(H,null,z(e.maxRating,(l,v)=>(n(),O(i,{key:v,name:l<=e.rating?"star-filled":"star",size:e.size,color:e.color,onClick:ne(h=>e.setRating(l),["stop"])},null,8,["name","size","color","onClick"]))),128))])}var Fe=g(He,[["render",Te]]);var Le=Object.defineProperty,We=Object.getOwnPropertyDescriptor,L=(e,t,o,r)=>{for(var s=r>1?void 0:r?We(t,o):t,c=e.length-1,i;c>=0;c--)(i=e[c])&&(s=(r?i(t,o,s):i(s))||s);return r&&s&&Le(t,o,s),s};let B=class extends C{constructor(){super(...arguments);a(this,"isAccepted");a(this,"modelValue");a(this,"text","")}get title(){return this.isAccepted?"\u0423\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u041E\u0442\u043A\u043B\u043E\u043D\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432"}get show(){return console.log({modelValue:this.modelValue}),this.modelValue}set show(e){console.log({value:e}),this.$emit("update:modelValue",e)}emitClose(){this.$emit("update:modelValue",!1)}emitAccept(){this.$emit("accept",this.text)}};L([$({type:Boolean,default:!1})],B.prototype,"isAccepted",2);L([$({type:Boolean,default:!1})],B.prototype,"modelValue",2);B=L([I({components:{BModal:ae,BInput:Q,BBtn:T},emits:["update:modelValue","accept"]})],B);const Ge=B,Je={class:"review-modal__action-list"},Xe=y(" \u041E\u0442\u043C\u0435\u043D\u0430 ");function Ke(e,t,o,r,s,c){const i=u("BInput"),l=u("b-btn"),v=u("BModal");return n(),O(v,{modelValue:e.show,"onUpdate:modelValue":t[1]||(t[1]=h=>e.show=h),class:"review-modal"},{title:f(()=>[y(w(e.title)+"? ",1)]),bottom:f(()=>[m("div",Je,[_(l,{type:"ghost",class:"review-modal__action",block:"",size:"s",onClick:e.emitClose},{default:f(()=>[Xe]),_:1},8,["onClick"]),_(l,{class:"review-modal__action",block:"",size:"s",onClick:e.emitAccept},{default:f(()=>[y(w(e.title),1)]),_:1},8,["onClick"])])]),default:f(()=>[e.isAccepted?(n(),O(i,{key:0,modelValue:e.text,"onUpdate:modelValue":t[0]||(t[0]=h=>e.text=h),class:"review-modal__text",type:"textarea",placeholder:"\u041E\u0442\u0432\u0435\u0442 \u043D\u0430 \u043E\u0442\u0437\u044B\u0432 (\u043D\u0435 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)"},null,8,["modelValue"])):ue("",!0)]),_:1},8,["modelValue"])}var Qe=g(Ge,[["render",Ke],["__scopeId","data-v-8e6fb944"]]);var Ye=Object.defineProperty,Ze=Object.getOwnPropertyDescriptor,Z=(e,t,o,r)=>{for(var s=r>1?void 0:r?Ze(t,o):t,c=e.length-1,i;c>=0;c--)(i=e[c])&&(s=(r?i(t,o,s):i(s))||s);return r&&s&&Ye(t,o,s),s};let P=class extends C{constructor(){super(...arguments);a(this,"comment")}get fullName(){const e=this.comment.user;if(!e)return"";const{lastName:t,firstName:o,middleName:r}=e;return`${t} ${o} ${r}`.trim()}emitAccept(){this.$emit("accept",this.comment.activityId)}emitDecline(){this.$emit("decline",this.comment.activityId)}};Z([$({type:Object,required:!0})],P.prototype,"comment",2);P=Z([I({components:{BBtn:T},emits:["accept","decline"]})],P);const ke=P,xe={class:"doctor-review-item"},et={class:"doctor-review-item__name"},tt={class:"doctor-review-item__comment"},ot={class:"doctor-review-item__action-list"},st=y(" \u041E\u0442\u043A\u043B\u043E\u043D\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432 "),rt=y(" \u0423\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432 ");function it(e,t,o,r,s,c){const i=u("b-btn");return n(),p("div",xe,[m("div",et,w(e.fullName||"-"),1),m("div",tt,w(e.comment.comment||"-"),1),m("div",ot,[_(i,{type:"uncolored",class:"doctor-review-item__action",block:"",size:"s",onClick:e.emitDecline},{default:f(()=>[st]),_:1},8,["onClick"]),_(i,{class:"doctor-review-item__action",block:"",size:"s",onClick:e.emitAccept},{default:f(()=>[rt]),_:1},8,["onClick"])])])}var ct=g(ke,[["render",it],["__scopeId","data-v-19295064"]]);var nt=Object.defineProperty,at=Object.getOwnPropertyDescriptor,W=(e,t,o,r)=>{for(var s=r>1?void 0:r?at(t,o):t,c=e.length-1,i;c>=0;c--)(i=e[c])&&(s=(r?i(t,o,s):i(s))||s);return r&&s&&nt(t,o,s),s};let b=class extends C{constructor(){super(...arguments);a(this,"comments",[]);a(this,"showAcceptModal",!1);a(this,"showDeclineModal",!1)}get doctorId(){return this.$route.query.doctorId}get selectedActivityId(){return this.$route.query.activityId}getLinkToConsultation(e){return this.$router.resolve({name:"doc-consultations",query:{role:"Doctor",userId:this.doctorId,consultationId:e}}).href}async fetchUserInfo(){this.comments.filter(t=>!t.user).forEach(async t=>{try{t.user=await we(t.clientId)}catch(o){console.log(o)}})}async fetchReviews(){var t;const e=this.doctorId;if(!!e)try{const{data:o}=await ve({doctorId:e});(o==null?void 0:o.length)&&(this.comments=o,this.setActivityId(this.comments[0].activityId))}catch(o){q.error((t=o.response.data)==null?void 0:t.error.description)}}acceptHandler(e){this.showAcceptModal=!0,this.setActivityId(e)}declineHandler(e){this.showDeclineModal=!0,this.setActivityId(e)}setActivityId(e){this.$router.push({query:j(M({},this.$route.query),{activityId:e})})}async modalHandler(e=!1,t=null){var o;try{const r=this.$route.query.activityId,s=this.comments.find(l=>l.activityId=r);if(!s)throw new Error("\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043D\u0435 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D");const{activityId:c,activityType:i}=s;e?await me({activityId:c,activityTypeName:i||""},{responseText:t}):await fe({activityId:c,activityTypeName:i||""})}catch(r){q.error((o=r.response.data)==null?void 0:o.error.description)}finally{this.showAcceptModal=!1,this.showDeclineModal=!1,this.fetchReviews(),this.setActivityId()}}mounted(){this.fetchReviews()}unmounted(){this.setActivityId()}};W([U("comments")],b.prototype,"fetchUserInfo",1);W([U("$route.query.doctorId")],b.prototype,"fetchReviews",1);b=W([I({components:{DoctorReviewItem:ct,ReviewModal:Qe,BAccordion:le,StarRating:Fe}})],b);const ut=b,lt=e=>(de("data-v-7a715dbc"),e=e(),_e(),e),dt={class:"doctor-review"},_t=lt(()=>m("h1",{class:"doctor-review__title"},"\u041E\u0447\u0435\u0440\u0435\u0434\u044C \u043D\u0430 \u043C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044E",-1)),pt={key:0,class:"doctor-review__review-list"},vt={class:"doctor-review__review-title"},mt=y(" \u041F\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u044E "),ft={key:1,class:"doctor-review__empty"};function ht(e,t,o,r,s,c){const i=u("StarRating"),l=u("router-link"),v=u("DoctorReviewItem"),h=u("BAccordion"),G=u("ReviewModal");return n(),p("div",dt,[_t,e.comments.length?(n(),p("div",pt,[(n(!0),p(H,null,z(e.comments,d=>(n(),O(h,{key:d.activityId,expanded:d.activityId===e.selectedActivityId,onSelect:N=>e.setActivityId(d.activityId)},{title:f(()=>{var N,J,X;return[m("div",vt,[_(i,{class:"doctor-review__review-rating",rating:d.score},null,8,["rating"]),_(l,{to:e.getLinkToConsultation(d.activityId)},{default:f(()=>[mt]),_:2},1032,["to"]),m("span",null,w((N=d.user)==null?void 0:N.lastName)+" "+w((J=d.user)==null?void 0:J.firstName)+" "+w((X=d.user)==null?void 0:X.middleName),1)])]}),default:f(()=>[_(v,{class:"doctor-review__review",comment:d,onAccept:e.acceptHandler,onDecline:e.declineHandler},null,8,["comment","onAccept","onDecline"])]),_:2},1032,["expanded","onSelect"]))),128))])):(n(),p("div",ft,"\u041E\u0447\u0435\u0440\u0435\u0434\u044C \u043F\u0443\u0441\u0442\u0430")),_(G,{modelValue:e.showAcceptModal,"onUpdate:modelValue":t[0]||(t[0]=d=>e.showAcceptModal=d),"is-accepted":"",onAccept:t[1]||(t[1]=d=>e.modalHandler(!0,d))},null,8,["modelValue"]),_(G,{modelValue:e.showDeclineModal,"onUpdate:modelValue":t[2]||(t[2]=d=>e.showDeclineModal=d),onAccept:e.modalHandler},null,8,["modelValue","onAccept"])])}var wt=g(ut,[["render",ht],["__scopeId","data-v-7a715dbc"]]);var $t=Object.defineProperty,yt=Object.getOwnPropertyDescriptor,Dt=(e,t,o,r)=>{for(var s=r>1?void 0:r?yt(t,o):t,c=e.length-1,i;c>=0;c--)(i=e[c])&&(s=(r?i(t,o,s):i(s))||s);return r&&s&&$t(t,o,s),s};let S=class extends C{};S=Dt([I({components:{DoctorsReviews:qe,DoctorReview:wt}})],S);const It=S,gt={class:"moderation-of-reviews"},Ct={class:"moderation-of-reviews__side"},Rt={class:"moderation-of-reviews__main"};function At(e,t,o,r,s,c){const i=u("DoctorsReviews"),l=u("DoctorReview");return n(),p("div",gt,[m("div",Ct,[_(i)]),m("div",Rt,[_(l)])])}var Nt=g(It,[["render",At],["__scopeId","data-v-f638560e"]]);export{Nt as default};
