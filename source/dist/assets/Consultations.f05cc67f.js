var at=Object.defineProperty,it=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var lt=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var q=(t,e,s)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,p=(t,e)=>{for(var s in e||(e={}))lt.call(e,s)&&q(t,s,e[s]);if(J)for(var s of J(e))ct.call(e,s)&&q(t,s,e[s]);return t},y=(t,e)=>it(t,nt(e));var c=(t,e,s)=>(q(t,typeof e!="symbol"?e+"":e,s),s);import{W as I,O as B,M as rt,R as dt,K as ht,E as _t,D as X,L as ft,S as mt,_ as A,V as S,r as f,o as l,k as r,l as o,n as h,w as $,F as v,J as k,t as _,m as C,I as pt,f as U,u as m,p as Y,s as Z,e as G,d as vt,i as Ct}from"./vendor.825dd2c3.js";import{h as N,U as Dt,g as yt,b as x,c as gt,a as bt,E as $t}from"./index.16741bc9.js";import{g as Et,a as wt}from"./index.056d9d85.js";import{F as It,S as K}from"./v1.ca8a8197.js";import{N as g}from"./notify.a97b9367.js";import{f as L,b as tt}from"./forrmaters.4a830e90.js";import{r as Bt,t as At,f as P}from"./date.7878141a.js";import{P as St}from"./preloader.bffd7f9b.js";function Q(t){Bt(1,arguments);var e=At(t);return e.setHours(23,59,59,999),e}const R="/api/telemed/v1";async function Nt(t){const{data:e}=await N.get(`${R}/consultations/paged`,{params:t});return e}async function Ft(t){const{data:e}=await N.get(`${R}/consultations/${t}`);return e}async function Vt(t){const{data:e}=await N.patch(`${R}/consultations/${t}/recover`);return e}async function kt(t){const{data:e}=await N.get(`${R}/ConsultationRecord`,{params:{consultationId:t}});return e}var Ut=Object.defineProperty,Lt=Object.getOwnPropertyDescriptor,et=(t,e,s,u)=>{for(var a=u>1?void 0:u?Lt(e,s):e,d=t.length-1,n;d>=0;d--)(n=t[d])&&(a=(u?n(e,s,a):n(a))||a);return u&&a&&Ut(e,s,a),a};let M=class extends S{constructor(){super(...arguments);c(this,"tab","doctor");c(this,"speciality",null);c(this,"specialties",[]);c(this,"loading",!1);c(this,"isConsultationLoading",!1);c(this,"firstName","");c(this,"lastName","");c(this,"middleName","");c(this,"phone","");c(this,"doctors",[]);c(this,"users",[]);c(this,"consultations",[]);c(this,"selectedUser",null);c(this,"statuses",[{label:"\u0412\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u043D\u044B\u0435",value:"Completed"},{label:"\u041E\u0442\u043C\u0435\u043D\u0435\u043D\u043D\u044B\u0435 \u0432\u0440\u0430\u0447\u043E\u043C",value:"CanceledByOperator"},{label:"\u041E\u0442\u043C\u0435\u043D\u0435\u043D\u043D\u044B\u0435 \u043F\u0430\u0446\u0438\u0435\u043D\u0442\u043E\u043C",value:"CanceledByClient"},{label:"\u0411\u0443\u0434\u0443\u0449\u0438\u0435",value:"New"}]);c(this,"hasMedia",!1);c(this,"filterDate","");c(this,"currentConsultationPage",1);c(this,"totalConsultations",0)}get userId(){return this.$route.query.userId}set userId(t){this.$router.replace(y(p({},this.$route),{query:y(p({},this.$route.query),{userId:t})}))}get selectedStatus(){return this.$route.query.status?this.statuses.find(t=>t.value===this.$route.query.status):this.statuses[0]}set selectedStatus(t){const e=y(p({},this.$route.query),{status:t?t.value:null});this.$router.replace(y(p({},this.$route),{query:e}))}get isMoreConsultations(){return this.consultations.length<this.totalConsultations}isActiveConsultation(t){return t===this.$route.query.consultationId}getDoctorId(t){return t.doctorId?t.doctorId:t.userId}getAvatarId(t){return t&&t.avatarId}fio(t){return L(t)}role(t){return t&&t.role==="Doctor"?"\u0414\u043E\u043A\u0442\u043E\u0440":"\u041F\u0430\u0446\u0438\u0435\u043D\u0442"}selectUser(t){t.doctorId?this.userId=t.doctorId:this.userId=t.userId,this.selectedUser=t,this.consultations=[],this.totalConsultations=0,this.tab="consultations"}selectConsultation(t){this.$router.push(y(p({},this.$route),{query:y(p({},this.$route.query),{consultationId:t.consultationId})}))}async fetchSpecialities(){const t=await Et();this.specialties=t.filter(e=>e.activityTypes&&e.activityTypes.some(s=>s.activityType===It.TELEMED&&s.flags&&s.flags.some(u=>u===K.IsUrgently||u===K.IsDirectly)))}async fetchClients(){this.loading=!0;const t={Roles:["Client"],Count:30};this.firstName&&(t.FirstName=this.firstName),this.lastName&&(t.LastName=this.lastName),this.middleName&&(t.MiddleName=this.middleName),this.phone&&(t.PhoneNumber=this.phone);try{let e=await yt(t);this.users=e.data}catch{g.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u043F\u0438\u0441\u043A\u0430 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u0432")}finally{this.loading=!1}}async fetchDoctors(){this.loading=!0;const t={};this.speciality&&this.speciality.specialityId&&(t.DoctorSpecialityId=this.speciality.specialityId);try{let e=await wt(t);this.firstName&&(e=e.filter(s=>s.firstName&&s.firstName.toLowerCase().includes(this.firstName.toLowerCase()))),this.lastName&&(e=e.filter(s=>s.lastName&&s.lastName.toLowerCase().includes(this.lastName.toLowerCase()))),this.middleName&&(e=e.filter(s=>s.middleName&&s.middleName.toLowerCase().includes(this.middleName.toLowerCase()))),this.doctors=e}catch{g.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u043F\u0438\u0441\u043A\u0430 \u0432\u0440\u0430\u0447\u0435\u0439")}finally{this.loading=!1}}async fetchUser(){try{this.selectedUser=await x(this.userId)}catch{g.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043E \u043A\u043B\u0438\u0435\u043D\u0442\u0435")}}formatDt(t){return P(new Date(t),"(HH:mm) dd.MM.yyyy")}getMediaSize(t){if(!t.consultationRecords)return"";const e=t.consultationRecords.reduce((s,u)=>s+u.fileSize,0);return tt(e)}changeFilters(){this.fetchConsultations(!1)}loadMoreConsultations(){this.currentConsultationPage+=1,this.fetchConsultations(!0)}async fetchConsultations(t=!1){this.isConsultationLoading=!0,t||(this.currentConsultationPage=1);const e={Status:this.selectedStatus.value};this.hasMedia&&(e.IsConsultationRecords=!0),this.selectedUser&&this.selectedUser.role==="Client"&&(e.ClientId=this.userId),this.selectedUser&&this.selectedUser.role==="Doctor"&&(e.DoctorId=this.userId),this.filterDate!==null&&typeof this.filterDate=="object"&&this.filterDate.from?(e.DateStart=new Date(this.filterDate.from).toISOString(),e.DateEnd=Q(new Date(this.filterDate.to)).toISOString()):this.filterDate&&(e.DateStart=new Date(this.filterDate).toISOString(),e.DateEnd=Q(new Date(this.filterDate)).toISOString()),e.Page=this.currentConsultationPage,e.Count=50;try{const s=await Nt(e);this.totalConsultations=s.totalCount,t?this.consultations=this.consultations.concat(s.data):this.consultations=s.data,this.consultations.forEach(u=>{u.consultationRecords&&u.consultationRecords.length&&(u.totalSize=this.getMediaSize(u))})}catch{g.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0441\u043F\u0438\u0441\u043A\u0430 \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0439")}finally{this.isConsultationLoading=!1}}async mounted(){this.userId&&(await this.fetchUser(),await this.fetchConsultations(),this.tab="consultations"),await this.fetchSpecialities()}};et([I("userId"),I("selectedStatus"),I("filterDate"),I("hasMedia")],M.prototype,"changeFilters",1);M=et([B({components:{BTabs:rt,BTab:dt,BSelect:ht,BInput:_t,BBtn:X,BCheckbox:ft,BDatepicker:mt,UserAvatar:Dt}})],M);const Pt=M,Mt=t=>(Y("data-v-f9a4fd38"),t=t(),Z(),t),Ot={class:"consultations-filter"},Rt={class:"consultations-filter__tabs"},zt={key:0},Tt={class:"consultations-filter__tab"},qt={class:"consultations-filter__inputs"},jt={class:"consultations-filter__inputsGroup"},Ht={class:"consultations-filter__submit"},Gt=m(" \u0418\u0441\u043A\u0430\u0442\u044C "),Wt={class:"consultations-filter-content"},Jt=["onClick"],Kt={class:"consultations-filter-item__col"},Qt={class:"consultations-filter-item__col"},Xt={class:"consultations-filter-item__name b-text-m"},Yt={class:"consultations-filter-item__desc"},Zt=m(" \u0423\u0442\u043E\u0447\u043D\u0438\u0442\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u043F\u043E\u0438\u0441\u043A\u0430 \u0438 \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043D\u0430 \u043A\u043D\u043E\u043F\u043A\u0443 \u0418\u0441\u043A\u0430\u0442\u044C "),xt={key:1},te={class:"consultations-filter__tab"},ee={class:"consultations-filter__inputs"},se={class:"consultations-filter__inputsGroup"},ue={class:"consultations-filter__submit"},oe=m(" \u0418\u0441\u043A\u0430\u0442\u044C "),ae={class:"consultations-filter-content"},ie=["onClick"],ne={class:"consultations-filter-item__col"},le={class:"consultations-filter-item__col"},ce={class:"consultations-filter-item__name b-text-m"},re={class:"consultations-filter-item__desc"},de=m(" \u0423\u0442\u043E\u0447\u043D\u0438\u0442\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u043F\u043E\u0438\u0441\u043A\u0430 \u0438 \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043D\u0430 \u043A\u043D\u043E\u043F\u043A\u0443 \u0418\u0441\u043A\u0430\u0442\u044C "),he={key:2},_e={class:"consultations-filter__tab"},fe={class:"consultations-filter-item"},me={class:"consultations-filter-item__col"},pe={class:"consultations-filter-item__col"},ve={class:"consultations-filter-item__name b-text-m"},Ce={class:"consultations-filter-item__desc"},De={class:"consultations-filter__picker"},ye={class:"consultations-filter__picker"},ge=m(" \u0421 \u043C\u0435\u0434\u0438\u0430\u0444\u0430\u0439\u043B\u043E\u043C \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0438 "),be={class:"consultations-filter-content"},$e=["onClick"],Ee={class:"consultations-item__col"},we={class:"consultations-item__name"},Ie={class:"consultations-item__desc"},Be={key:0,class:"consultations-item__col"},Ae=Mt(()=>o("div",{class:"consultations-item__name"},"\u041C\u0435\u0434\u0438\u0430",-1)),Se={class:"consultations-item__desc"},Ne=m(" \u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0435\u0449\u0451 "),Fe=m(" \u041A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0439 \u043D\u0435\u0442 ");function Ve(t,e,s,u,a,d){const n=f("b-tab"),b=f("b-tabs"),V=f("b-select"),D=f("b-input"),w=f("b-btn"),T=f("user-avatar"),ut=f("b-datepicker"),ot=f("b-checkbox");return l(),r("div",Ot,[o("div",Rt,[h(b,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=i=>t.tab=i),class:"consultations-filter__tabs-content"},{default:$(()=>[h(n,{label:"\u0414\u043E\u043A\u0442\u043E\u0440",name:"doctor"}),h(n,{label:"\u041A\u043B\u0438\u0435\u043D\u0442",name:"client"}),h(n,{label:"\u041A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0438",name:"consultations",disabled:!t.userId},null,8,["disabled"])]),_:1},8,["modelValue"]),t.tab==="doctor"?(l(),r("div",zt,[o("div",Tt,[h(V,{modelValue:t.speciality,"onUpdate:modelValue":e[1]||(e[1]=i=>t.speciality=i),options:t.specialties,placeholder:"\u0421\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u044C \u0432\u0440\u0430\u0447\u0430","option-label":"specialityName"},null,8,["modelValue","options"]),o("div",qt,[o("div",jt,[h(D,{modelValue:t.lastName,"onUpdate:modelValue":e[2]||(e[2]=i=>t.lastName=i),class:"consultations-filter__lastname",placeholder:"\u0424\u0430\u043C\u0438\u043B\u0438\u044F","float-label":"",canceled:""},null,8,["modelValue"]),h(D,{modelValue:t.firstName,"onUpdate:modelValue":e[3]||(e[3]=i=>t.firstName=i),placeholder:"\u0418\u043C\u044F","float-label":"",canceled:""},null,8,["modelValue"])]),h(D,{modelValue:t.middleName,"onUpdate:modelValue":e[4]||(e[4]=i=>t.middleName=i),placeholder:"\u041E\u0442\u0447\u0435\u0441\u0442\u0432\u043E","float-label":"",canceled:""},null,8,["modelValue"]),o("div",Ht,[h(w,{size:"m",loading:t.loading,onClick:t.fetchDoctors},{default:$(()=>[Gt]),_:1},8,["loading","onClick"])])]),o("div",Wt,[t.doctors.length?(l(!0),r(v,{key:0},k(t.doctors,i=>(l(),r("div",{key:t.getDoctorId(i),class:"consultations-filter-item _hover",onClick:W=>t.selectUser(i)},[o("div",Kt,[h(T,{"avatar-id":i.avatarId},null,8,["avatar-id"])]),o("div",Qt,[o("div",Xt,_(t.fio(i)),1),o("div",Yt,_(t.role(i)),1)])],8,Jt))),128)):(l(),r(v,{key:1},[Zt],64))])])])):C("",!0),t.tab==="client"?(l(),r("div",xt,[o("div",te,[h(D,{phone:t.phone,"onUpdate:phone":e[5]||(e[5]=i=>t.phone=i),placeholder:"\u041D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430","is-phone":"","float-label":"",canceled:""},null,8,["phone"]),o("div",ee,[o("div",se,[h(D,{modelValue:t.lastName,"onUpdate:modelValue":e[6]||(e[6]=i=>t.lastName=i),class:"consultations-filter__lastname",placeholder:"\u0424\u0430\u043C\u0438\u043B\u0438\u044F","float-label":"",canceled:""},null,8,["modelValue"]),h(D,{modelValue:t.firstName,"onUpdate:modelValue":e[7]||(e[7]=i=>t.firstName=i),placeholder:"\u0418\u043C\u044F","float-label":"",canceled:""},null,8,["modelValue"])]),h(D,{modelValue:t.middleName,"onUpdate:modelValue":e[8]||(e[8]=i=>t.middleName=i),placeholder:"\u041E\u0442\u0447\u0435\u0441\u0442\u0432\u043E","float-label":"",canceled:""},null,8,["modelValue"]),o("div",ue,[h(w,{size:"m",loading:t.loading,onClick:t.fetchClients},{default:$(()=>[oe]),_:1},8,["loading","onClick"])])]),o("div",ae,[t.users.length?(l(!0),r(v,{key:0},k(t.users,i=>(l(),r("div",{key:t.getDoctorId(i),class:"consultations-filter-item _hover",onClick:W=>t.selectUser(i)},[o("div",ne,[h(T,{"avatar-id":i.avatarId},null,8,["avatar-id"])]),o("div",le,[o("div",ce,_(t.fio(i)),1),o("div",re,_(t.role(i)),1)])],8,ie))),128)):(l(),r(v,{key:1},[de],64))])])])):C("",!0),t.tab==="consultations"?(l(),r("div",he,[o("div",_e,[o("div",fe,[o("div",me,[h(T,{"avatar-id":t.getAvatarId(t.selectedUser)},null,8,["avatar-id"])]),o("div",pe,[o("div",ve,_(t.fio(t.selectedUser)),1),o("div",Ce,_(t.role(t.selectedUser)),1)])]),h(V,{modelValue:t.selectedStatus,"onUpdate:modelValue":e[9]||(e[9]=i=>t.selectedStatus=i),options:t.statuses,placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441","no-reset":""},null,8,["modelValue","options"]),o("div",De,[h(ut,{modelValue:t.filterDate,"onUpdate:modelValue":e[10]||(e[10]=i=>t.filterDate=i),placeholder:"\u0414\u0430\u0442\u0430 \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0438",range:""},null,8,["modelValue"])]),o("div",ye,[h(ot,{modelValue:t.hasMedia,"onUpdate:modelValue":e[11]||(e[11]=i=>t.hasMedia=i)},{default:$(()=>[ge]),_:1},8,["modelValue"])]),o("div",be,[t.consultations.length?(l(),r(v,{key:0},[(l(!0),r(v,null,k(t.consultations,i=>(l(),r("div",{key:i.consultationId,class:pt([{_active:t.isActiveConsultation(i.consultationId)},"consultations-item"]),onClick:W=>t.selectConsultation(i)},[o("div",Ee,[o("div",we,_(i.issueNumber||"\u041F\u043E \u043A\u0430\u043B\u0435\u043D\u0434\u0430\u0440\u044E"),1),o("div",Ie,_(t.formatDt(i.calculatedDateStart)),1)]),i.totalSize?(l(),r("div",Be,[Ae,o("div",Se,_(i.totalSize),1)])):C("",!0)],10,$e))),128)),t.isMoreConsultations?(l(),U(w,{key:0,size:"m",block:"",loading:t.isConsultationLoading,onClick:t.loadMoreConsultations},{default:$(()=>[Ne]),_:1},8,["loading","onClick"])):C("",!0)],64)):C("",!0),!t.isConsultationLoading&&!t.consultations.length?(l(),r(v,{key:1},[Fe],64)):C("",!0)])])])):C("",!0)])])}var ke=A(Pt,[["render",Ve],["__scopeId","data-v-f9a4fd38"]]);var Ue=Object.defineProperty,Le=Object.getOwnPropertyDescriptor,z=(t,e,s,u)=>{for(var a=u>1?void 0:u?Le(e,s):e,d=t.length-1,n;d>=0;d--)(n=t[d])&&(a=(u?n(e,s,a):n(a))||a);return u&&a&&Ue(e,s,a),a};let E=class extends S{constructor(){super(...arguments);c(this,"documents");c(this,"label");c(this,"maxLength")}get shortenDocs(){const t=(this.maxLength-4)/2;return this.documents.map(e=>{const s=e[this.label],u=s.length<this.maxLength?s:`${s.slice(0,t)}...${s.slice(-t)}`;return y(p({},e),{label:u})})}async downloadDocument(t){const e=t[this.label],s=await gt({fileId:t.fileId,fileName:e}),u=document.createElement("a");u.href=s,u.download=e,document.body.appendChild(u),u.click(),document.body.removeChild(u)}bytesToSize(t){return tt(t)}};z([G(Array)],E.prototype,"documents",2);z([G({type:String,default:"fileLabel"})],E.prototype,"label",2);z([G({type:Number,default:20})],E.prototype,"maxLength",2);E=z([B({})],E);const Pe=E,Me={class:"doc-document"},Oe=["onClick"];function Re(t,e,s,u,a,d){return l(),r("span",Me,[(l(!0),r(v,null,k(t.shortenDocs,n=>(l(),r("span",{key:n.fileId,class:"doc-document__item b-text-link",onClick:b=>t.downloadDocument(n)},_(`${n.label} (${t.bytesToSize(n.fileSize)})`)+"; ",9,Oe))),128))])}var ze=A(Pe,[["render",Re],["__scopeId","data-v-b1d4672a"]]),Te=Object.defineProperty,qe=Object.getOwnPropertyDescriptor,je=(t,e,s,u)=>{for(var a=u>1?void 0:u?qe(e,s):e,d=t.length-1,n;d>=0;d--)(n=t[d])&&(a=(u?n(e,s,a):n(a))||a);return u&&a&&Te(e,s,a),a};let j=class extends S{};j=je([B({})],j);const He=j;function Ge(t,e,s,u,a,d){return l(),r("div",null,"Chat")}var We=A(He,[["render",Ge]]);const Je="/api/renchat/v2";async function Ke({chatId:t,Take:e,Skip:s}){const u={};s?u.Skip=s:u.Take=e;const{data:a}=await N.get(`${Je}/messages/${t}`,{params:u});return a}var Qe=vt("chat",{state:()=>({userId:"",messages:[],blocksAnotherMessages:[],connection:null,connected:!1,chats:{},typing:!1,showRate:!1,unreadCount:0,suggests:[]}),actions:{async getMessages({chatId:t="",Take:e=20,Skip:s=""}){const u=await Ke({chatId:t,Take:e,Skip:s?P(new Date(s),"backend"):void 0});return s&&u.length<20?this.getMessages({chatId:t,Take:20}):u}}});var Xe=Object.defineProperty,Ye=Object.getOwnPropertyDescriptor,st=(t,e,s,u)=>{for(var a=u>1?void 0:u?Ye(e,s):e,d=t.length-1,n;d>=0;d--)(n=t[d])&&(a=(u?n(e,s,a):n(a))||a);return u&&a&&Xe(e,s,a),a};let O=class extends S{constructor(){super(...arguments);c(this,"accountStore",bt());c(this,"chatStore",Qe());c(this,"loading",!1);c(this,"hasChatMessages",!1);c(this,"consultation");c(this,"doctor");c(this,"patient");c(this,"isRestoreLoading",!1);c(this,"isPolicy",!1);c(this,"medias",[])}get consultationId(){return this.$route.query.consultationId}get isAdmin(){return this.accountStore.isAdmin}get isConsultationCanceled(){return this.consultation&&this.consultation.status&&this.consultation.status.includes("Canceled")}recordUrl(){return this.isPolicy?window.location.origin+"/op/doc/record/"+this.consultationId:window.location.origin+"/op/doc/consultations/c/record/"+this.consultationId}async restoreConsultation(){var t;this.isRestoreLoading=!0;try{this.consultation&&(await Vt((t=this.consultation)==null?void 0:t.consultationId),$t.$emit("consultationRestore"),g.success("\u041A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u044F \u0432\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430"))}catch{g.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0438")}finally{this.isRestoreLoading=!1}}async fetchConsultationInfo(){this.loading=!0;try{this.consultation=await Ft(this.consultationId),await this.fetchUser(this.consultation.clientId),await this.fetchUser(this.consultation.doctorId),await this.fetchMedia(this.consultation.consultationId),await this.fetchChatMessages(this.consultation.chatId)}catch(t){console.log(t),g.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u0438")}finally{this.loading=!1}}async fetchUser(t){if(!t)return Promise.resolve();try{const e=await x(t);e.role==="Doctor"?this.doctor=e:e.role==="Client"&&(this.patient=e)}catch{g.error("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D")}}async fetchMedia(t){if(!this.consultation)return;const e=await kt(t),s=P(new Date(this.consultation.calculatedDateStart)),u="\u041F\u0430\u0446\u0438\u0435\u043D\u0442_"+L(this.patient).split(" ").join("_"),a="\u0432\u0440\u0430\u0447_"+L(this.doctor).split(" ").join("_");this.medias=e.map((d,n)=>y(p({},d),{fileLabel:`${s}_${u}_${a}${n>0?"_"+n:""}.${d.fileName.replace(/.*\./,"")}`}))}async fetchChatMessages(t){try{const e=await this.chatStore.getMessages({chatId:t});this.hasChatMessages=!!e.length}catch{g.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u043F\u0438\u0441\u043A\u0430 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439")}}close(){let t=p({},this.$route.query);delete t.consultationId,this.$router.replace(y(p({},this.$route),{query:t}))}fio(t){return L(t)}formatDt(t){return P(new Date(t),"(HH:mm) dd.MM.yyyy")}changeConsultationId(t){this.hasChatMessages=!1,t?this.fetchConsultationInfo():this.consultation=void 0}};st([I("consultationId",{immediate:!0})],O.prototype,"changeConsultationId",1);O=st([B({components:{Preloader:St,DocDocuments:ze,BBtn:X,BIcon:Ct,DocChat:We}})],O);const Ze=O,F=t=>(Y("data-v-7dcada0c"),t=t(),Z(),t),xe={class:"consultation-view"},ts={key:0,class:"consultation-view__loading"},es={class:"consultation-view__title"},ss={key:0,class:"consultation-view__field"},us=F(()=>o("span",{class:"consultation-view__fieldLabel"},"\u041F\u0430\u0446\u0438\u0435\u043D\u0442:",-1)),os={key:1,class:"consultation-view__field"},as=F(()=>o("span",{class:"consultation-view__fieldLabel"},"\u0412\u0440\u0430\u0447:",-1)),is={key:2,class:"consultation-view__field"},ns=F(()=>o("span",{class:"consultation-view__fieldLabel"},"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438:",-1)),ls={class:"consultation-view__field"},cs=m(" \u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u044E "),rs={class:"consultation-view__attachments"},ds={class:"consultation-view__field"},hs=["href"],_s={class:"consultation-view__field"},fs=F(()=>o("span",{class:"consultation-view__fieldLabel"},"\u041C\u0435\u0434\u0438\u0430:",-1)),ms=m("\u041C\u0435\u0434\u0438\u0430\u0444\u0430\u0439\u043B\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B \u0438\u043B\u0438 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u044E\u0442\u0441\u044F."),ps={class:"consultation-view__field"},vs=F(()=>o("span",{class:"consultation-view__fieldLabel"},"\u0414\u043E\u043A\u0443\u043C\u0435\u043D\u0442\u044B:",-1)),Cs={class:"consultation-view__chat"},Ds={class:"consultation-view__chatContainer"},ys={key:1},gs=m(" \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u0446\u0438\u044E ");function bs(t,e,s,u,a,d){const n=f("preloader"),b=f("b-icon"),V=f("b-btn"),D=f("doc-documents"),w=f("doc-chat");return l(),r("div",xe,[t.loading?(l(),r("div",ts,[h(n)])):!t.loading&&t.consultationId&&t.consultation?(l(),r(v,{key:1},[h(b,{size:"35",name:"close",class:"consultation-view__closeBtn",onClick:t.close},null,8,["onClick"]),o("div",es,_(t.formatDt(t.consultation.calculatedDateStart))+" "+_(t.consultation.issueNumber||"\u041F\u043E \u0437\u0430\u043F\u0438\u0441\u0438"),1),t.patient?(l(),r("div",ss,[us,m(" "+_(t.fio(t.patient)),1)])):C("",!0),t.doctor?(l(),r("div",os,[as,m(" "+_(t.consultation.doctorSpeciality.specialityName)+" "+_(t.fio(t.doctor)),1)])):C("",!0),t.consultation.doctorComment?(l(),r("div",is,[ns,m(" "+_(t.consultation.doctorComment),1)])):C("",!0),o("div",ls,[t.isConsultationCanceled&&t.isAdmin?(l(),U(V,{key:0,disabled:t.isRestoreLoading,onClick:t.restoreConsultation},{default:$(()=>[cs]),_:1},8,["disabled","onClick"])):C("",!0)]),o("section",rs,[o("div",ds,[o("a",{class:"b-text-link",href:t.recordUrl(),target:"_blank"}," \u041C\u0435\u0434.\u043A\u0430\u0440\u0442\u0430 ",8,hs)]),o("div",_s,[fs,t.medias.length?(l(),U(D,{key:0,documents:t.medias,label:"fileLabel"},null,8,["documents"])):(l(),r(v,{key:1},[ms],64))]),o("div",ps,[vs,h(D,{documents:t.consultation.documents,label:"fileName"},null,8,["documents"])])]),o("section",Cs,[o("div",Ds,[t.hasChatMessages?(l(),U(w,{key:0,chatId:t.consultation.chatId,type:"operator",role:"operator",disabled:""},null,8,["chatId"])):(l(),r("span",ys,"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u043D\u0435\u0442"))])])],64)):(l(),r(v,{key:2},[gs],64))])}var $s=A(Ze,[["render",bs],["__scopeId","data-v-7dcada0c"]]);var Es=Object.defineProperty,ws=Object.getOwnPropertyDescriptor,Is=(t,e,s,u)=>{for(var a=u>1?void 0:u?ws(e,s):e,d=t.length-1,n;d>=0;d--)(n=t[d])&&(a=(u?n(e,s,a):n(a))||a);return u&&a&&Es(e,s,a),a};let H=class extends S{};H=Is([B({components:{ConsultationsFilter:ke,ConsultationsView:$s}})],H);const Bs=H,As={class:"consultations"},Ss={class:"consultations__filter"},Ns={class:"consultations__view"};function Fs(t,e,s,u,a,d){const n=f("consultations-filter"),b=f("consultations-view");return l(),r("div",As,[o("div",Ss,[h(n)]),o("div",Ns,[h(b)])])}var Ts=A(Bs,[["render",Fs],["__scopeId","data-v-6cdc5bb1"]]);export{Ts as default};
